[supervisord]
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid

# PostgreSQL - embedded database (DEC-039)
# Must start before the API since it depends on the database
[program:postgres]
command=/usr/lib/postgresql/16/bin/postgres -D /config/postgres
user=postgres
autostart=true
autorestart=true
priority=100
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
redirect_stderr=true

# Printarr API - starts after PostgreSQL (priority 200 > 100)
[program:api]
command=python -m uvicorn app.main:app --host %(ENV_PRINTARR_HOST)s --port %(ENV_PRINTARR_PORT)s
directory=/app/backend
autostart=true
autorestart=true
priority=200
startsecs=5
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
redirect_stderr=true

# Workers will be added in future versions
# [program:ingestion-worker]
# command=python -m app.workers.ingestion
# directory=/app/backend
# autostart=true
# autorestart=true
# priority=300
# stdout_logfile=/dev/fd/1
# stdout_logfile_maxbytes=0
# redirect_stderr=true

# [program:download-worker]
# command=python -m app.workers.download
# directory=/app/backend
# autostart=true
# autorestart=true
# priority=300
# stdout_logfile=/dev/fd/1
# stdout_logfile_maxbytes=0
# redirect_stderr=true

# [program:preview-worker]
# command=python -m app.workers.preview
# directory=/app/backend
# autostart=true
# autorestart=true
# priority=300
# stdout_logfile=/dev/fd/1
# stdout_logfile_maxbytes=0
# redirect_stderr=true
